<!doctype html>

<title>RBush Tree Visualization</title>
<canvas id="canvas" width="701" height="701"></canvas>

<script src="../rbush.js"></script>
<script>

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');

var N = 50000,
    W = 700,
    data = [];

function randBox(size) {
    var x = Math.random() * (700 - size),
        y = Math.random() * (700 - size);
    return [x, y,
        x + size * Math.random(),
        y + size * Math.random()];
}

for (var i = 0; i < N; i++) {
    data[i] = randBox(1);
}

var tree = rbush(10).load(data);

var colors = ['red', 'blue', 'green'];

var rects;

function drawTree(node, level) {
    var rect = [];

    if (level) {
        rect.push(colors[(level - 1) % colors.length]);
        rect.push(1 / level);
        rect.push([
            Math.round(node.bbox[0]) + 0.5,
            Math.round(node.bbox[1]) + 0.5,
            Math.round(node.bbox[2] - node.bbox[0]),
            Math.round(node.bbox[3] - node.bbox[1])
        ]);
    }

    rects.push(rect);

    if (node.leaf) return;
    //if (level === 8) { return; }

    for (var i = 0; i < node.children.length; i++) {
        drawTree(node.children[i], level + 1);
    }
}

function draw() {
    rects = [];
    drawTree(tree.data, 0);

    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, W + 1, W + 1);

    for (var i = rects.length - 1; i >= 0; i--) {
        ctx.strokeStyle = rects[i][0];
        ctx.globalAlpha = rects[i][1];
        ctx.strokeRect.apply(ctx, rects[i][2]);
    }
}

draw();

function insertRandom() {
    console.time('insert 10 items');
    for (var i = 0; i < 10; i++) {
        tree.insert(randBox(1));
    }
    console.timeEnd('insert 10 items');

    draw();
}

</script>
